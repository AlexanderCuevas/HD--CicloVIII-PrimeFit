{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./auth.service\";\nexport class CarritoService {\n  constructor(http, authService) {\n    this.http = http;\n    this.authService = authService;\n    this.apiUrl = 'http://localhost:3000/api/carrito';\n    this.carritoSubject = new BehaviorSubject([]);\n    this.carrito$ = this.carritoSubject.asObservable();\n    this.loadCarrito();\n  }\n  getHeaders() {\n    const token = this.authService.getToken();\n    return new HttpHeaders({\n      'Authorization': `Bearer ${token}`\n    });\n  }\n  loadCarrito() {\n    // Cargar desde localStorage\n    const carritoGuardado = localStorage.getItem('carrito');\n    if (carritoGuardado) {\n      const items = JSON.parse(carritoGuardado);\n      this.carritoSubject.next(items);\n    }\n  }\n  agregarItem(plato, restauranteNombre) {\n    const items = this.getItems();\n    const existente = items.find(item => item.platoId === plato.id);\n    if (existente) {\n      existente.cantidad++;\n    } else {\n      const nuevoItem = {\n        id: Date.now().toString(),\n        platoId: plato.id,\n        nombre: plato.nombre,\n        precio: plato.precio,\n        cantidad: 1,\n        imagen: plato.imagen,\n        restauranteNombre: restauranteNombre,\n        calorias: plato.calorias,\n        proteinas: plato.proteinas\n      };\n      items.push(nuevoItem);\n    }\n    this.guardarCarrito(items);\n  }\n  getItems() {\n    const carritoGuardado = localStorage.getItem('carrito');\n    return carritoGuardado ? JSON.parse(carritoGuardado) : [];\n  }\n  guardarCarrito(items) {\n    localStorage.setItem('carrito', JSON.stringify(items));\n    this.carritoSubject.next(items);\n  }\n  getCantidadTotal() {\n    const items = this.getItems();\n    return items.reduce((total, item) => total + item.cantidad, 0);\n  }\n  // Métodos para cuando el usuario esté logueado (mantener compatibilidad)\n  agregarItemAPI(platoId, cantidad = 1) {\n    return this.http.post(`${this.apiUrl}/items`, {\n      platoId,\n      cantidad\n    }, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito.items || [])));\n  }\n  actualizarCantidad(platoId, cantidad) {\n    return this.http.put(`${this.apiUrl}/items/${platoId}`, {\n      cantidad\n    }, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito)));\n  }\n  eliminarItem(platoId) {\n    return this.http.delete(`${this.apiUrl}/items/${platoId}`, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito.items || [])));\n  }\n  vaciarCarrito() {\n    return this.http.delete(this.apiUrl, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito.items || [])));\n  }\n  getCantidadItems() {\n    const items = this.carritoSubject.value;\n    return items.reduce((total, item) => total + item.cantidad, 0);\n  }\n  static {\n    this.ɵfac = function CarritoService_Factory(t) {\n      return new (t || CarritoService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AuthService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CarritoService,\n      factory: CarritoService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["HttpHeaders","BehaviorSubject","tap","CarritoService","constructor","http","authService","apiUrl","carritoSubject","carrito$","asObservable","loadCarrito","getHeaders","token","getToken","carritoGuardado","localStorage","getItem","items","JSON","parse","next","agregarItem","plato","restauranteNombre","getItems","existente","find","item","platoId","id","cantidad","nuevoItem","Date","now","toString","nombre","precio","imagen","calorias","proteinas","push","guardarCarrito","setItem","stringify","getCantidadTotal","reduce","total","agregarItemAPI","post","headers","pipe","carrito","actualizarCantidad","put","eliminarItem","delete","vaciarCarrito","getCantidadItems","value","i0","ɵɵinject","i1","HttpClient","i2","AuthService","factory","ɵfac","providedIn"],"sources":["C:\\Users\\rodri\\OneDrive\\Escritorio\\HERRAMIENTAS DESARROLLO\\PRIME-FINAL\\HD--CicloVIII-PrimeFit\\App-Front\\src\\app\\services\\carrito.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { AuthService } from './auth.service';\r\n\r\nexport interface ItemCarrito {\r\n  id: string;\r\n  platoId: string;\r\n  nombre: string;\r\n  precio: number;\r\n  cantidad: number;\r\n  imagen: string;\r\n  restauranteNombre: string;\r\n  calorias?: number;\r\n  proteinas?: number;\r\n}\r\n\r\nexport interface Carrito {\r\n  usuarioId: number;\r\n  items: ItemCarrito[];\r\n  total: number;\r\n  cantidadItems: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CarritoService {\r\n  private apiUrl = 'http://localhost:3000/api/carrito';\r\n  private carritoSubject = new BehaviorSubject<ItemCarrito[]>([]);\r\n  public carrito$ = this.carritoSubject.asObservable();\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private authService: AuthService\r\n  ) {\r\n    this.loadCarrito();\r\n  }\r\n\r\n  private getHeaders(): HttpHeaders {\r\n    const token = this.authService.getToken();\r\n    return new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`\r\n    });\r\n  }\r\n\r\n  loadCarrito(): void {\r\n    // Cargar desde localStorage\r\n    const carritoGuardado = localStorage.getItem('carrito');\r\n    if (carritoGuardado) {\r\n      const items = JSON.parse(carritoGuardado);\r\n      this.carritoSubject.next(items);\r\n    }\r\n  }\r\n\r\n  agregarItem(plato: any, restauranteNombre: string): void {\r\n    const items = this.getItems();\r\n    const existente = items.find(item => item.platoId === plato.id);\r\n\r\n    if (existente) {\r\n      existente.cantidad++;\r\n    } else {\r\n      const nuevoItem: ItemCarrito = {\r\n        id: Date.now().toString(),\r\n        platoId: plato.id,\r\n        nombre: plato.nombre,\r\n        precio: plato.precio,\r\n        cantidad: 1,\r\n        imagen: plato.imagen,\r\n        restauranteNombre: restauranteNombre,\r\n        calorias: plato.calorias,\r\n        proteinas: plato.proteinas\r\n      };\r\n      items.push(nuevoItem);\r\n    }\r\n\r\n    this.guardarCarrito(items);\r\n  }\r\n\r\n  getItems(): ItemCarrito[] {\r\n    const carritoGuardado = localStorage.getItem('carrito');\r\n    return carritoGuardado ? JSON.parse(carritoGuardado) : [];\r\n  }\r\n\r\n  guardarCarrito(items: ItemCarrito[]): void {\r\n    localStorage.setItem('carrito', JSON.stringify(items));\r\n    this.carritoSubject.next(items);\r\n  }\r\n\r\n  getCantidadTotal(): number {\r\n    const items = this.getItems();\r\n    return items.reduce((total, item) => total + item.cantidad, 0);\r\n  }\r\n\r\n  // Métodos para cuando el usuario esté logueado (mantener compatibilidad)\r\n  agregarItemAPI(platoId: number, cantidad: number = 1): Observable<Carrito> {\r\n    return this.http.post<Carrito>(\r\n      `${this.apiUrl}/items`,\r\n      { platoId, cantidad },\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap((carrito: Carrito) => this.carritoSubject.next(carrito.items || []))\r\n    );\r\n  }\r\n\r\n  actualizarCantidad(platoId: number, cantidad: number): Observable<Carrito> {\r\n    return this.http.put<Carrito>(\r\n      `${this.apiUrl}/items/${platoId}`,\r\n      { cantidad },\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap(carrito => this.carritoSubject.next(carrito))\r\n    );\r\n  }\r\n\r\n  eliminarItem(platoId: number): Observable<Carrito> {\r\n    return this.http.delete<Carrito>(\r\n      `${this.apiUrl}/items/${platoId}`,\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap((carrito: Carrito) => this.carritoSubject.next(carrito.items || []))\r\n    );\r\n  }\r\n\r\n  vaciarCarrito(): Observable<Carrito> {\r\n    return this.http.delete<Carrito>(\r\n      this.apiUrl,\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap((carrito: Carrito) => this.carritoSubject.next(carrito.items || []))\r\n    );\r\n  }\r\n\r\n  getCantidadItems(): number {\r\n    const items = this.carritoSubject.value;\r\n    return items.reduce((total, item) => total + item.cantidad, 0);\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}