{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./auth.service\";\nexport class CarritoService {\n  constructor(http, authService) {\n    this.http = http;\n    this.authService = authService;\n    this.apiUrl = 'http://localhost:3000/api/carrito';\n    this.carritoSubject = new BehaviorSubject(null);\n    this.carrito$ = this.carritoSubject.asObservable();\n    if (this.authService.isAuthenticated()) {\n      this.loadCarrito();\n    }\n  }\n  getHeaders() {\n    const token = this.authService.getToken();\n    return new HttpHeaders({\n      'Authorization': `Bearer ${token}`\n    });\n  }\n  loadCarrito() {\n    this.http.get(this.apiUrl, {\n      headers: this.getHeaders()\n    }).subscribe(carrito => this.carritoSubject.next(carrito));\n  }\n  agregarItem(platoId, cantidad = 1) {\n    return this.http.post(`${this.apiUrl}/items`, {\n      platoId,\n      cantidad\n    }, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito)));\n  }\n  actualizarCantidad(platoId, cantidad) {\n    return this.http.put(`${this.apiUrl}/items/${platoId}`, {\n      cantidad\n    }, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito)));\n  }\n  eliminarItem(platoId) {\n    return this.http.delete(`${this.apiUrl}/items/${platoId}`, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito)));\n  }\n  vaciarCarrito() {\n    return this.http.delete(this.apiUrl, {\n      headers: this.getHeaders()\n    }).pipe(tap(carrito => this.carritoSubject.next(carrito)));\n  }\n  getCantidadItems() {\n    return this.carritoSubject.value?.cantidadItems || 0;\n  }\n  static {\n    this.ɵfac = function CarritoService_Factory(t) {\n      return new (t || CarritoService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AuthService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CarritoService,\n      factory: CarritoService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["HttpHeaders","BehaviorSubject","tap","CarritoService","constructor","http","authService","apiUrl","carritoSubject","carrito$","asObservable","isAuthenticated","loadCarrito","getHeaders","token","getToken","get","headers","subscribe","carrito","next","agregarItem","platoId","cantidad","post","pipe","actualizarCantidad","put","eliminarItem","delete","vaciarCarrito","getCantidadItems","value","cantidadItems","i0","ɵɵinject","i1","HttpClient","i2","AuthService","factory","ɵfac","providedIn"],"sources":["C:\\Users\\rodri\\OneDrive\\Escritorio\\HERRAMIENTAS DESARROLLO\\PRIME-FINAL\\HD--CicloVIII-PrimeFit\\App-Front\\src\\app\\services\\carrito.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, BehaviorSubject } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { AuthService } from './auth.service';\r\n\r\nexport interface Carrito {\r\n  usuarioId: number;\r\n  items: any[];\r\n  total: number;\r\n  cantidadItems: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CarritoService {\r\n  private apiUrl = 'http://localhost:3000/api/carrito';\r\n  private carritoSubject = new BehaviorSubject<Carrito | null>(null);\r\n  public carrito$ = this.carritoSubject.asObservable();\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private authService: AuthService\r\n  ) {\r\n    if (this.authService.isAuthenticated()) {\r\n      this.loadCarrito();\r\n    }\r\n  }\r\n\r\n  private getHeaders(): HttpHeaders {\r\n    const token = this.authService.getToken();\r\n    return new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`\r\n    });\r\n  }\r\n\r\n  loadCarrito(): void {\r\n    this.http.get<Carrito>(this.apiUrl, { headers: this.getHeaders() })\r\n      .subscribe(carrito => this.carritoSubject.next(carrito));\r\n  }\r\n\r\n  agregarItem(platoId: number, cantidad: number = 1): Observable<Carrito> {\r\n    return this.http.post<Carrito>(\r\n      `${this.apiUrl}/items`,\r\n      { platoId, cantidad },\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap(carrito => this.carritoSubject.next(carrito))\r\n    );\r\n  }\r\n\r\n  actualizarCantidad(platoId: number, cantidad: number): Observable<Carrito> {\r\n    return this.http.put<Carrito>(\r\n      `${this.apiUrl}/items/${platoId}`,\r\n      { cantidad },\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap(carrito => this.carritoSubject.next(carrito))\r\n    );\r\n  }\r\n\r\n  eliminarItem(platoId: number): Observable<Carrito> {\r\n    return this.http.delete<Carrito>(\r\n      `${this.apiUrl}/items/${platoId}`,\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap(carrito => this.carritoSubject.next(carrito))\r\n    );\r\n  }\r\n\r\n  vaciarCarrito(): Observable<Carrito> {\r\n    return this.http.delete<Carrito>(\r\n      this.apiUrl,\r\n      { headers: this.getHeaders() }\r\n    ).pipe(\r\n      tap(carrito => this.carritoSubject.next(carrito))\r\n    );\r\n  }\r\n\r\n  getCantidadItems(): number {\r\n    return this.carritoSubject.value?.cantidadItems || 0;\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}